<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>앱 실행 테스트</title>
    <script>
      function openAppOrStore() {
        const universalLink = "https://dev-frontuser.mossp.co.kr";
        const iosStoreUrl = "https://apps.apple.com/app/id1518550286";
        const androidStoreUrl = "market://details?id=com.mmaa.narasarangapp";

        const userAgent = navigator.userAgent.toLowerCase();
        const isAndroid = userAgent.includes("android");
        const isIOS = /iphone|ipad|ipod/.test(userAgent);
        const storeUrl = isAndroid ? androidStoreUrl : isIOS ? iosStoreUrl : null;

        if (!storeUrl) {
          alert("이 기능은 모바일 기기에서만 사용할 수 있습니다.");
          return;
        }

        const timeout = setTimeout(() => {
          location.href = storeUrl;
        }, 2000);

        // iOS는 유니버설 링크를 새 탭으로 열어 현재 페이지 유지 → fallback 작동
        if (isIOS) {
          const win = window.open(universalLink, '_blank');
          if (!win) {
            // 팝업 차단된 경우 fallback
            clearTimeout(timeout);
            location.href = storeUrl;
          }
        } else {
          // Android는 현재 창에서 실행
          location.href = universalLink;
        }

        document.addEventListener('visibilitychange', () => {
          if (document.visibilityState === 'hidden') {
            clearTimeout(timeout);
          }
        });
      }
    </script>
  </head>
  <body>
    <h2>앱 실행 테스트</h2>
    <p>앱이 설치되어 있다면 실행되고, 설치되어 있지 않다면 스토어로 이동합니다.</p>
    <button onclick="openAppOrStore()">앱 실행하기</button>
  </body>
</html>
